<!DOCTYPE html>
<html lang="en">
<head>
<link rel = "stylesheet" href = "/static/style.css">
<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PR Tracker</title>
</head>
<body>
  <div class = "logo-anim">
    <a href ="/">
      <img src = "/static/dumbbell.png" alt = "Dumbbell" />
    </a>
  </div>


  <div class="main">

    <aside class="sidebar">
      <h2>Exercises</h2>
      <ul id="exercise-list"></ul> 

      <h2>Add New</h2>
      <input type="text" id="new-exercise" placeholder="Exercise name..." />
      <button onclick="addExercise()">Add</button>
    </aside>

    <main class="content">
      <div id="empty-state">
        <p>Select an exercise to get started</p>
      </div>

      <div id="exercise-view" style="display:none">
        <h2 id="view-title"></h2>
        <p>Current PR: <strong id="current-pr">â€”</strong></p>

        <div class="log-form">
          <input type="number" id="log-weight" placeholder="Weight" />
          <input type="number" id="log-reps" placeholder="Reps" />
          <select id="log-unit">
            <option value="lbs">lbs</option>
            <option value="kg">kg</option>
          </select>
          <input type="date" id="log-date" />
          <button onclick="logSet()">Log Set</button>
        </div>

        <div id="hype-box" style="display:none">
          <p id="hype-text"></p>
        </div>

        <h3>History</h3>
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Weight</th>
              <th>Reps</th>
            </tr>
          </thead>
          <tbody id="history-body"></tbody>
        </table>
      </div>
    </main>

  </div>

  <script>

    let exercises = [];
    let selectedExerciseId = null;

    async function loadExercises() {
      const res = await fetch('/api/exercises');
      exercises = await res.json();
      renderExcerciseList();
    }

    // gets list of exercises and put it in the li 
    function renderExcerciseList(){
      const ul = document.getElementById('exercise-list');
       ul.innerHTML = exercises.map(ex => `
    <li class="${ex.id === selectedExerciseId ? 'active' : ''}">
      <span onclick="selectExercise(${ex.id}, '${ex.name}')">${ex.name}</span>
      <button onclick="deleteExercise(${ex.id})" class="delete-btn">x</button>
    </li>
  `).join('');

    }
// function when selected an exercise
    async function selectExercise(id, name){
      selectExerciseId = id
      renderExcerciseList();
      //once clicked, will hide the message and u view the selected exercises
  document.getElementById('empty-state').style.display = 'none';
  document.getElementById('exercise-view').style.display = 'block';
  //shows the name of the exercise u selected
  document.getElementById('view-title').textContent = name;
  document.getElementById('hype-box').style.display = 'none';
  await loadLogs(id);
    }
// fetch logs for selected exercises
    async function loadLogs(id){
      const res = await fetch(`/api/logs/${id}`);;
      const logs = await res.json(); 
      renderHistory(logs);
      updateCurrentPR(logs);
    }

    //show current pr on top
    function updateCurrentPR(logs){
      const prs = logs.filter(l => l.is_pr);
      if (prs.length == 0){
        document.getElementById('current-pr').textContent = '-';
        return;
      }
      const best = prs.reduce((a,b) => a.weight > b.weight ? a : b);
      document.getElementById('current-pr').textContent = `${best.weight}${best.unit}`;
    }
 
    //history of workouts
    function renderHistory(logs){
      const hisbody = document.getElementById('history-body');
      //if no logs, shows error message
      if(logs.length === 0){
        hisbody.innerHTML = `<tr><td colspan="3" style="text-align:center;color:#444;padding:40px">No sets logged yet</td></tr>`;
    return;
      }

      //show the list of exercises u did
      hisbody.innerHTML = [...logs].reverse().map(l => `
    <tr class="${l.is_pr ? 'is-pr' : ''}">
      <td>${l.date}</td>
      <td>${l.weight}${l.unit}</td>
      <td>${l.reps} reps</td>
    </tr>
  `).join('');
    }
//log data to backend api
    async function logSet(){
      //data
      const weight = parseFloat(document.getElementById('log-weight').value);
      const reps = parseInt(document.getElementById('log-reps').value);
      const unit = document.getElementById('log-unit'.value);
      const date = documnet.getElementById('log-date'.value);

      if (!weight || !reps){
        alert('Enter weight and reps.');
        return;
      }
//post data to backend
    const res = await fetch('/api/logs', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ exercise_id: selectedExerciseId, weight, reps, unit, date })
  });
    const data = await res.json();

//if u hit the pr, u get a hype text
        if (data.is_pr){
          const box = document.getElementById('hype-box');
          document.getElementById('hype-text').textContent = 'New PR is set. Keep growing';
          box.style.display = 'block';
        }

        document.getElementById('log-weight').value = '';
        document.getElementById('log-reps').value = '';
        await loadLogs(selectedExerciseId);
      };

//save new exercise to database and shows it in the sidebar
      async function addExercise(){
        const input = document.getElementById('new-exercise');
        const name = input.value.trim();
        if (!name) return;
        const res = await fetch('/api/exercises', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body:JSON.stringify({name})
        });

        if (res.ok) {
          const ex = await res.json();
          exercises.push(ex);
          renderExcerciseList();
          input.value = '';
          selectExercise(ex.id, ex.name);

        }
        if (name == name){
          alert("You have already added this exercise");
        }
      }

      async function deleteExercise(id) {
          //if not wanna delete
        if (!confirm('Are you sure you want to delete this exercise and all of its current logs?')) return;
          //fetch
        await fetch(`/api/exercises/${id}`, { method: 'DELETE' });
          //filter
        exercises = exercises.filter(ex => ex.id !== id);
          //logic
        if (selectedExerciseId === id){
          selectedExerciseId = null;
          document.getElementById('exercise-view').style.display = 'none';
          document.getElementById('empty-state').style.display = 'block';
        }
          renderExcerciseList();
      }
  loadExercises();
    
  </script>

  



</body>
</html>